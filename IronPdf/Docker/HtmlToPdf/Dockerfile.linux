# escape=`

FROM mcr.microsoft.com/dotnet/core/sdk:3.1-buster-slim as dotnet-sdk
RUN dotnet --list-sdks

FROM mcr.microsoft.com/dotnet/core/runtime:3.1-buster as dotnet
RUN dotnet --list-runtimes

FROM dotnet-sdk AS build
WORKDIR /src
COPY "HtmlToPdf.Console" .
RUN dotnet clean "HtmlToPdf.Console.csproj" --nologo
RUN dotnet restore "HtmlToPdf.Console.csproj"
RUN dotnet build "HtmlToPdf.Console.csproj" -c Release -o /app/build
WORKDIR /app/build
RUN dir

FROM build AS publish
WORKDIR /src
RUN dotnet publish "HtmlToPdf.Console.csproj" -c Release -o /app/publish
WORKDIR /app/publish
RUN dir

FROM dotnet AS final
WORKDIR /app
VOLUME "/pdf-result"
COPY --from=publish /app/publish .
RUN dir
ENTRYPOINT ["dotnet", "HtmlToPdf.Console.dll"]
